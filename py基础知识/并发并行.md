# 多道技术


多道技术中的“多道”指的是多个程序。多道技术的实现是为了解决多个程序竞争或共享同一个资源（如CPU）的有序调度问题。随着计算机硬件的发展，尤其是CPU和内存性能的提升，多道技术成为提高系统性能的重要手段。


## 时间上的复用（CPU）

- 当一个程序在等待I/O操作时（如读写硬盘、网络请求等），CPU可以切换到另一个程序执行，从而避免CPU的空闲等待，提高CPU的利用率。
- 操作系统会根据一定的调度算法（如轮转调度、优先级调度等）来分配CPU时间片给各个程序，实现程序的并发执行。

## 空间上的复用（内存）

- 多个程序可以同时加载到内存中，各自占用一部分内存空间。这种空间上的复用使得多个程序可以同时存在于内存中，等待CPU的调度执行。
- 需要注意的是，不同程序之间的内存区域需要相互隔离，以保证数据的安全性和稳定性。这种隔离通常是通过操作系统的内存管理机制来实现的。

内存中同时存入多道（多个）程序，cpu从一个进程快速切换到另外一个，使每个进程各自运行几十或几百毫秒，这样，虽然在某一个瞬间，一个cpu只能执行一个任务，但在1秒内，cpu却可以运行多个进程，这就给人产生了并行的错觉，即**伪并发**，以此来区分多处理器操作系统的真正硬件并行（多个cpu共享同一个物理内存）

# 同步异步

同步（Synchronous）：在发出一个功能调用时，在没有得到结果之前，该调用就不会返回。就是按照代码一步一步执行

异步（Asynchronous）：异步的概念和同步相对。当一个异步功能调用发出后，调用者不能立刻得到结果。当该异步功能完成后，通过**状态、通知或回调**来通知调用者。如果异步功能用状态来通知，那么调用者就需要每隔一定时间检查一次，效率就很低（有些初学多线程编程的人，总喜欢用一个循环去检查某个变量的值，这其实是一 种很严重的错误）。如果是使用通知的方式，效率则很高，因为异步功能几乎不需要做额外的操作。至于回调函数，其实和通知没太多区别。

异步是并发的一种实现方式，线程是实现异步的一个方式

一个进程可以包含多个线程

同步和异步是描述任务执行方式的概念，它们可以应用于线程或进程的执行中。无论是线程还是进程，都可以采用同步或异步的方式来执行任务。

# 进程

## 进程的状态

三种状态：运行-阻塞-就绪

进程在等待I/O时的状态为阻塞

在两种情况下会导致一个进程在逻辑上不能运行，

　　1. 进程挂起是自身原因，遇到I/O阻塞，便要让出CPU让其他进程去执行，这样保证CPU一直在工作

　　2. 与进程无关，是操作系统层面，可能会因为一个进程占用时间过多，或者优先级等原因，而调用其他的进程去使用CPU。

# python并发编程

## 进程 process

Python提供了multiprocessing，用来开启子进程

 multiprocessing模块的功能众多：支持子进程、通信和共享数据、执行不同形式的同步，提供了Process、Queue、Pipe、Lock等组件。

  需要再次强调的一点是：与线程不同，进程没有任何共享状态，进程修改的数据，改动仅限于该进程内

  ## 线程 thread

  　在传统操作系统中，每个进程有一个地址空间，而且默认就有一个控制线程

　　线程顾名思义，就是一条流水线工作的过程，一条流水线必须属于一个车间，一个车间的工作过程是一个进程

      车间负责把资源整合到一起，是一个资源单位，而一个车间内至少有一个流水线

      流水线的工作需要电源，电源就相当于cpu

　　所以，进程只是用来把资源集中到一起（进程只是一个资源单位，或者说资源集合），而线程才是cpu上的执行单位。

不同的进程之间是竞争关系（360和qq），不同的线程是合作关系

多线程指在一个进程中开启多个线程

知识点：
1. 多线程共享一个进程的地址空间

2. 线程比进程更轻量级，线程比进程更容易创建可撤销，在许多操作系统中，创建一个线程比创建一个进程要快10-100倍，在有大量线程需要动态和快速修改时，这一特性很有用

3. 若多个线程都是cpu密集型的，那么并不能获得性能上的增强，但是如果存在大量的计算和大量的I/O处理，拥有多个线程允许这些活动彼此重叠运行，从而会加快程序执行的速度。

4. 在多cpu系统中，为了最大限度的利用多核，可以开启多个线程，比开进程开销要小的多。（这一条并不适用于python）